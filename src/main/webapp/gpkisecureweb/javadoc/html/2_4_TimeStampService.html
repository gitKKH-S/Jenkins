<html>
<head>
 <TITLE>표준보안API JAVA 메뉴얼</TITLE>
</head>
</html>

<body>
<br><br>
<p>

<table width="100%">
<tr>
 <td align=center valign=bottom>
   <h1>시점확인 서비스 이용하기</h1>
 </td>
</table>

<p>
<blockquote>

<center>

<table width=90% cellspacing=0 cellpadding=5>
<tr>
 <td> 전자문서의 작성일자를 실제 시간보다 전이나 후에 작성된 것처럼 도용하는 것을 방지하거나 어느 시점에 전자문서를 가지고 있었음을 증명하기 위한 시점확인 서비스를 이용하여 시점확인 토큰을 발급 받는다. </td> 
</tr>
</table>

<br><br>

<table width=90% cellspacing=0 cellpadding=5>
<tr>
 <td width=20> <img src="../img/check.gif"> </td>
 <td> <b>과정</b> </td>
</tr>
</table>

<br>

<table border=1 width=80% cellspacing=0 cellpadding=5>
<tr bgcolor=lightgrey>
 <th align=center width=70%> 클라이언트 </td> 
 <th align=center width=30%> &nbsp </td> 
</tr>
<tr>
 <td align=left> 시점확인 토큰을 발급 받을 전자문서를 획득한다. </td> 
 <td align=center> &nbsp </td> 
</tr>
<tr>
 <td align=left> 시점확인 토큰 요청 메시지를 생성하여 시점확인 서버에 전송하여 시점확인 토큰을 받음  </td> 
 <td align=center valign=middle> <img src="../img/left_arrow.gif"> 시점확인 서버와 통신<img src="../img/right_arrow.gif"> </td> 
</tr>
<tr>
 <td align=left> 시점확인 서버로부터 받은 응답 메시지를 처리하고 시점확인 토큰을 획득 </td> 
 <td align=center> &nbsp </td> 
</tr>
<tr>
 <td align=left> 시점확인 토큰의 내용을 확인 </td> 
 <td align=center> &nbsp </td> 
</tr>
</table>

<br><br>

<table width=90% cellspacing=0 cellpadding=5>
<tr>
 <td width=20> <img src="../img/check.gif"> </td>
 <td> <b>샘플 코드</b> </td>
</tr>
</table>

<br>
<table border=1 width=80% cellspacing=0 cellpadding=5>
<tr>
 <td>
<pre>
public class TimeStampService {
	
	void obtainTimeStampToken() {

		try {
			// API 초기화
			GpkiApi.init(".");
	
			// 시점확인 토큰을 발급 받을 전자문서를 획득한다.
			byte[] bDocument = Disk.read("./Document.txt");
			
			// 전자문서에 대한 시점확인 토큰을 요청한다.
			TimeStamp timeStamp = new TimeStamp();
			timeStamp.setMessage(bDocument);
			TimeStampToken timeStampToken = timeStamp.reqTimeStampToken("152.99.56.61", 80);
			
			// 받은 시점확인 토큰의 정보를 확인한다.
			
			System.out.println("* 시점확인 토큰 정보 ");
			
			// 1. 시점확인 서버의 이름
			X509Certificate tsaCert = timeStampToken.getTSACert();
			System.out.println("  [TSA 서버 DN] " + tsaCert.getSubjectDN());
			
			// 2. 시점확인 토큰의 일련번호
			BigInteger serialNum = timeStampToken.getSerialNumber();
			
			System.out.print("  [토큰 일련번호] " + serialNum + "(");
			
			byte[] bBuf = serialNum.toByteArray();
			for (int i=0; i < bBuf.length; i++)
				System.out.print(Dump.getHexString(bBuf[i]));
			
			System.out.println(")");
			
			// 시점확인 토큰 생성시간
			System.out.println("  [토큰 생성시간] " + timeStampToken.getGeneratedTime());
			
			// 시점확인 토큰 발급 정책
			System.out.println("  [토큰 발급정책] " + timeStampToken.getPolicy());
			
			// 시점확인 토큰을 요청한 메시지의 해쉬값  생성을 위해서 사용된 알고리즘
			System.out.println("  [해쉬 알고리즘] " + timeStampToken.getHashAlgorithm());
			
			// 시점확인 토큰을 요청한 메시지의 해쉬값
			System.out.print("  [메시지 해쉬값] ");
			
			bBuf = timeStampToken.getMessageImprint();
			for (int i=0; i < bBuf.length; i++)
				System.out.print(Dump.getHexString(bBuf[i]));
			
			System.out.println(" ");
		
			// 시점확인 토큰을 요청을 위해서 사용된 랜덤
			System.out.print("  [Nonce] ");
			
			bBuf = timeStampToken.getNonce();
			for (int i=0; i < bBuf.length; i++)
				System.out.print(Dump.getHexString(bBuf[i]));
			
			System.out.println(" ");
			
		} catch (Exception e) {
			e.printStackTrace();		
		}
	}
}
</pre>
 </td>
</tr>
</table>

</blockquote>
</p>

</center>

<br>
<hr size=3 noshade>
<br>
<table width=100%>
<tr>
 <td align=left width=50% rowspan=2>
   <a href="../index.html"><img src="../img/home.gif" border=0></a>
 </td>
 <td align=right width=50%>
   <font size=2> Copyright &#169; 2003~2016 Government Computerization Center (GCC). </font>
 </td>
</tr>
<tr>
 <td align=right>
   <font size=2> All Rights Reserved. </font>
 </td>
</tr>
</table>
</font>

</body>
</html>
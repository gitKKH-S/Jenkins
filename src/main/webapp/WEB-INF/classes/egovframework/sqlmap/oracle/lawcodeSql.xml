<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/WEB-INF/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lawcodeSql">
	<!-- 셀렉트박스  -->
	<select id="SelectBox" parameterType="java.util.HashMap" resultType="HashMap">
		SELECT CD_MNG_NO,CD_LCLSF_ENG_NM, CD_NM, CD_LCLSF_KORN_NM  FROM TB_COM_CD
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="CD_LCLSF_ENG_NM != null">
			      AND CD_LCLSF_ENG_NM in 
			      <foreach item="item" index="index" collection="CD_LCLSF_ENG_NM" open="(" separator="," close=")">
			      	#{item}
			      </foreach>
			</if>
			AND USE_YN='Y'
		</trim>
		ORDER BY SORT_SEQ
	</select>
	
	<insert id="InsertprelawJob">
		<selectKey keyProperty="CD_MNG_NO" resultType="String" order="BEFORE">
			SELECT KEYID.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_COM_CD 
			(CD_MNG_NO,CD_LCLSF_ENG_NM,CD_LCLSF_KORN_NM,CD_NM,SORT_SEQ,USE_YN) 
			VALUES
			(#{CD_MNG_NO},#{CD_LCLSF_ENG_NM},#{CD_LCLSF_KORN_NM},#{CD_NM},#{SORT_SEQ},#{USE_YN})
	</insert>
	
	<select id="getPrelawJobdt" resultType="HashMap">
		SELECT * FROM TB_COM_CD 
		WHERE 
		CD_LCLSF_ENG_NM=#{CD_LCLSF_ENG_NM} AND 
		CD_MNG_NO = (SELECT MAX(CD_MNG_NO) FROM TB_COM_CD WHERE CD_LCLSF_ENG_NM=#{CD_LCLSF_ENG_NM})
	</select>
	
	<!-- 코드 분류 가져오기 -->
	<select id="getCode" resultType="HashMap">
		SELECT DISTINCT (CD_LCLSF_ENG_NM) AS CD_LCLSF_ENG_NM, CD_LCLSF_KORN_NM
		FROM TB_COM_CD
		WHERE USE_YN = 'Y'
		<if test="schTxt != null and schTxt != ''">
			AND CD_LCLSF_KORN_NM LIKE '%'||#{schTxt}||'%'
		</if>
		<!--WHERE CD_LCLSF_ENG_NM NOT IN ('DEPTNAME')
		
		SELECT CD_NM, MAX(CD_MNG_NO) AS CD_MNG_NO FROM
		(SELECT DISTINCT(CD_LCLSF_KORN_NM) AS CD_NM FROM TB_COM_CD WHERE CD_LCLSF_ENG_NM NOT IN('JOB','DEPTNAME')) A
		,
		(SELECT CD_MNG_NO , CD_LCLSF_KORN_NM FROM TB_COM_CD WHERE CD_LCLSF_ENG_NM NOT IN('JOB','DEPTNAME')) B WHERE A.CD_NM=B.CD_LCLSF_KORN_NM
		GROUP BY CD_NM
	-->
	</select>
	
	<!-- 코드 분류별 리스트 가져오기 -->
	<select id="getCodeList" parameterType="String" resultType="HashMap">
		SELECT CD_MNG_NO, CD_LCLSF_ENG_NM, CD_LCLSF_KORN_NM, CD_NM, SORT_SEQ, USE_YN
		FROM TB_COM_CD
		WHERE CD_LCLSF_ENG_NM = #{CD_LCLSF_ENG_NM}
		ORDER BY SORT_SEQ, CD_MNG_NO
	</select>
	
	<!-- 코드 레코드 업데이트 -->
	<update id="updateCode" parameterType="HashMap">
		UPDATE TB_COM_CD
		SET CD_LCLSF_ENG_NM=#{CD_LCLSF_ENG_NM}, CD_LCLSF_KORN_NM=#{CD_LCLSF_KORN_NM}, CD_NM=#{CD_NM}, SORT_SEQ=#{SORT_SEQ}, USE_YN=#{USE_YN}
		WHERE CD_MNG_NO = #{CD_MNG_NO}
	</update>
	
	<!-- 코드 레코드 생성 -->
	<insert id="createCode" parameterType="HashMap">
		<selectKey keyProperty="CD_MNG_NO" resultType="int" order="BEFORE">
			SELECT KEYID.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_COM_CD 
		VALUES (#{CD_MNG_NO},#{CD_LCLSF_ENG_NM},#{CD_LCLSF_KORN_NM},#{CD_NM},#{SORT_SEQ},#{USE_YN})
	</insert>
	
	<!-- 코드 레코드 삭제 -->
	<delete id="deleteCode">
		DELETE FROM TB_COM_CD
		WHERE CD_MNG_NO = #{CD_MNG_NO}
	</delete>
	
	<!-- SORT_SEQ 데이터 가져오기 -->
	<select id="getOrd" resultType="HashMap">
		SELECT SORT_SEQ 
		FROM TB_COM_CD
		WHERE CD_LCLSF_ENG_NM = #{CD_LCLSF_ENG_NM}
		ORDER BY SORT_SEQ
	</select>
	
	<!-- SORT_SEQ 재정렬 -->
	<update id="updateOrd" parameterType="HashMap">
		UPDATE TB_COM_CD
		SET SORT_SEQ=SORT_SEQ+1
		WHERE CD_LCLSF_ENG_NM = #{CD_LCLSF_ENG_NM} AND SORT_SEQ>=#{SORT_SEQ}
	</update>
	
	<!-- SORT_SEQ 재정렬 -->
	<update id="updateOrd2" parameterType="HashMap">
		UPDATE TB_COM_CD
		SET SORT_SEQ=SORT_SEQ+2
		WHERE CD_LCLSF_ENG_NM = #{CD_LCLSF_ENG_NM} AND SORT_SEQ>#{SORT_SEQ}
	</update>
	
	<!-- 코드레코드 정보 가져오기 -->
	<select id="getCodeInfo"  resultType="HashMap">
		SELECT CD_MNG_NO,CD_LCLSF_ENG_NM,CD_LCLSF_KORN_NM,CD_NM,SORT_SEQ,USE_YN
		FROM TB_COM_CD
		WHERE CD_MNG_NO=#{CD_MNG_NO}
	</select>
	
	<select id="getMaxord" resultType="String">
		SELECT MAX(SORT_SEQ) FROM TB_COM_CD WHERE CD_LCLSF_ENG_NM=(
			SELECT CD_LCLSF_ENG_NM
			FROM TB_COM_CD
			WHERE CD_MNG_NO=#{CD_MNG_NO}
		)
	</select>
	
	<select id="getAlCode" resultType="HashMap">
		SELECT CD_MNG_NO,CD_LCLSF_ENG_NM,CD_LCLSF_KORN_NM,CD_NM,SORT_SEQ,USE_YN
		FROM TB_COM_CD
		WHERE CD_LCLSF_ENG_NM='STANDARDLAW'
	</select>
	
	<select id="getStandardLawList" resultType="HashMap">
		select * from TB_LM_STANDARDLAW
		where   
		<if test="CD_MNG_NO != null and CD_MNG_NO != ''">
			gbn = #{CD_MNG_NO}
		</if>
		
		<if test="schTxt != ''">
			<if test="CD_MNG_NO != ''">
				and
			</if>
			word LIKE '%'||#{schtxt}||'%'
		</if>
	</select>
	
	<insert id="createWord" parameterType="HashMap">
		<selectKey keyProperty="standardid" resultType="int" order="BEFORE">
			SELECT KEYID.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_LM_STANDARDLAW 
		(
			standardid,gbn,word,standardword,USE_YN
			<if test="filename != null and filename != ''">
			,filename
			</if>
		)
		VALUES (#{standardid},#{gbn},#{word},#{standardword},#{USE_YN}
		<if test="filename != null and filename != ''">
			,#{filename}		
		</if>
		)
	</insert>
	<update id="updateWord">
		UPDATE TB_LM_STANDARDLAW
		SET word=#{word}, standardword=#{standardword}, gbn=#{gbn}, USE_YN=#{USE_YN}
		<if test="filename != null and filename != ''">
			, filename=#{filename}
		</if>
		WHERE standardid = #{standardid}
	</update>
	<delete id="deleteWord" parameterType="int">
		DELETE FROM TB_LM_STANDARDLAW
		WHERE standardid = #{standardid}
	</delete>
	
	<insert id="createGbn">
		<selectKey keyProperty="CD_MNG_NO" resultType="int" order="BEFORE">
			SELECT KEYID.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_COM_CD 
			(CD_MNG_NO,CD_LCLSF_ENG_NM,CD_LCLSF_KORN_NM,CD_NM,SORT_SEQ,USE_YN) 
			VALUES
			(#{CD_MNG_NO},'STANDARDLAW',#{CD_LCLSF_KORN_NM},#{CD_NM},(select max(SORT_SEQ)+1 from TB_COM_CD where CD_LCLSF_ENG_NM = 'STANDARDLAW'),'Y')
	</insert>
	
	<select id="GetXmlAlbub" resultType="HashMap">
		select * from TB_LM_STANDARDLAW
	</select>
	
	<select id="getSeq" resultType="String"  useCache="false" flushCache="true">
		SELECT KEYID.NEXTVAL FROM DUAL
	</select>
	

</mapper>
